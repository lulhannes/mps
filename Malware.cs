using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace MPS
{
    public class Malware
    {
        private int firewall;
        private int antivirus;

        public Malware(int firewall, int antivirus)
        {
            this.firewall = firewall;
            this.antivirus = antivirus;
        }
        
        public void Infecteer(Apparaat app)
        {
            if (!app.Infecties.Contains(this) && app.Firewall <= firewall)
            {
                app.Infecties.Add(this);
            }
        }

        /// <summary>
        /// Returnt alle buren van geinfecteerde apparaten.
        /// </summary>
        public List<Apparaat[]> GetAlleBuren()
        {
            // Zoek geinfecteerde apparaten
            List<Apparaat> appInfected = new List<Apparaat>();
            foreach (Apparaat app in (from app in Netwerk.Apparatuur where app.Infecties.Contains(this) select app))
            {
                appInfected.Add(app);
            }

            // Zoek hun ongeinfecteerde buren
            List<Apparaat[]> teInfecteren = new List<Apparaat[]>();
            foreach (Apparaat appInf in appInfected)
            {
                foreach (Apparaat[] bnd in (from bnd in Netwerk.Verbindingen where bnd.Contains(appInf) select bnd))
                {
                    if (bnd[0] != appInf && !bnd[0].Infecties.Contains(this))
                    {
                        teInfecteren.Add(new Apparaat[] { bnd[0], bnd[1] });
                    }
                    else if (bnd[1] != appInf && !bnd[1].Infecties.Contains(this))
                    {
                        teInfecteren.Add(new Apparaat[] { bnd[1], bnd[0] });
                    }
                }
            }
            return teInfecteren;
        }
    }
}
